<div class="bg-soft-bone card-pixel p-4 md:p-6 mb-4 md:mb-8">
  <% if ENV['UPDATES_STATUS'] == 'locked' %>
    <div class="text-center">
      <div class="flex justify-center items-center">
        <%= image_tag 'sad.png', class: 'w-16 h-16 sm:w-48 sm:h-48 2xl:w-64 2xl:h-64 transform scale-x-[-1] mb-4 sm:mb-6' %>
      </div>
      <p class="mb-6 sm:mb-8 text-black text-large sm:text-xl 2xl:text-2xl">Posting updates is currently locked. Updates will be unlocked on Tuesday, April 15th.</p>
    </div>
  <% else %>
    <h3 class="text-xl md:text-2xl 2xl:text-3xl font-steven mb-3 md:mb-4">Add Update</h3>
    <%= form_with(model: [@project, @project.updates.build], class: "space-y-3 md:space-y-4", data: { controller: "form", action: "submit->form#preventDoubleSubmission" }) do |f| %>
      <div class="space-y-1.5 md:space-y-2">
        <%= f.label :text, "Update Text", class: "block text-base md:text-lg 2xl:text-xl" %>
        <%= f.text_area :text, class: "w-full p-2 border-2 border-black focus:outline-none focus:border-forest text-base md:text-lg 2xl:text-xl", rows: 4, required: true %>
      </div>

      <div class="space-y-1.5 md:space-y-2">
        <%= f.label :attachment, "Attachment (Optional)", class: "block text-base md:text-lg 2xl:text-xl" %>
        <div class="w-full border-2 border-dashed border-black p-4 md:p-6 flex flex-col items-center justify-center space-y-4 transition-all duration-300" 
             data-controller="attachment"
             data-action="dragover->attachment#highlight dragleave->attachment#unhighlight drop->attachment#handleDrop click->attachment#handleClick"
             data-attachment-target="dropzone">
          
          <div data-attachment-target="initial" class="flex flex-col items-center space-y-4">
            <%= inline_svg_tag "attachment.svg", class: "w-12 h-12 md:w-16 md:h-16" %>
            <p class="text-base md:text-lg 2xl:text-xl text-center">Drag and drop files here or click to select</p>
            <p class="text-sm text-gray-600">Supports images, audio, video, and GIFs</p>
          </div>

          <div data-attachment-target="uploading" class="hidden flex flex-col items-center space-y-4">
            <%= inline_svg_tag "lollipop.svg", class: "w-16 h-16 2xl:w-20 2xl:h-20 animate-spin" %>
            <p class="text-base md:text-lg 2xl:text-xl">Uploading...</p>
          </div>

          <div data-attachment-target="preview" class="hidden w-full">
            <div data-attachment-target="imagePreview" class="hidden">
              <img class="w-full h-48 md:h-64 object-contain" data-attachment-target="previewImage">
            </div>
            
            <div data-attachment-target="videoPreview" class="hidden">
              <video class="w-full h-48 md:h-64 object-contain" controls data-attachment-target="previewVideo"></video>
            </div>
            
            <div data-attachment-target="audioPreview" class="hidden">
              <audio class="w-[90%]" controls data-attachment-target="previewAudio"></audio>
            </div>

            <div class="flex justify-end mt-4">
              <button type="button" 
                      class="px-2 md:px-4 py-2 bg-vintage-red hover:scale-[1.05] text-white transition-transform duration-300 text-sm md:text-base 2xl:text-xl btn-pixel cursor-pointer"
                      data-action="click->attachment#removeFile">
                Remove
              </button>
            </div>
          </div>

          <%= f.hidden_field :attachment, data: { attachment_target: "input" } %>
        </div>
      </div>

      <div class="flex justify-end">
        <%= f.submit "Post Update", class: "px-4 md:px-6 py-2 bg-forest hover:scale-[1.05] text-white transition-transform duration-300 text-sm md:text-base 2xl:text-xl btn-pixel cursor-pointer", data: { form_target: "submitButton" } %>
      </div>
    <% end %>
  <% end %>
</div>
